<!DOCTYPE HTML>
<head>
<meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://tls.homeinfo.de/libs/bootstrap/latest/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="immobrowse.css">
  <link rel="stylesheet" href="default.css">
  <script src="https://tls.homeinfo.de/libs/jquery/jquery-latest.min.js"></script>
  <script src="https://tls.homeinfo.de/libs/bootstrap/latest/js/bootstrap.min.js"></script>
  <script src="https://tls.homeinfo.de/javascript/homeinfo.js"></script>
  <script src="https://tls.homeinfo.de/javascript/immobrowse.js"></script>
  <script src="https://tls.homeinfo.de/javascript/immobrowse_oo.js"></script>
  <script>
    var cid = location.search.slice(1);
    var exposeUrl = 'detailexpose.html?cid={cid}&extern={objektnr_extern}';
    var sorting = {
      property: null,
      order: null
    }
    var filters;
    var list;
    var container;
    var loader;

    function toggleOrder() {
      var previousOrder = sorting.order;

      if (sorting.order == 'descending') {
        sorting.order = 'ascending';
      } else {
        sorting.order = 'descending';
      }

      return previousOrder;
    }

    function filter() {
      updateFilters();
      list.sort(sorting.property, sorting.order);
      list = new immobrowse.List(cid, filters, sorting, exposeUrl);
    }

    function toggleSorting(property) {
      var previousIssuer = document.getElementById(sorting.property);
      var issuer = document.getElementById(property);
      toggleOrder();
      sorting.property = property;

      // Remove arrow symbol
      if (previousIssuer != null) {
        previousIssuer.innerHTML = previousIssuer.innerHTML.slice(0, -1);
      }

      switch (sorting.order) {
        case 'ascending':
          issuer.innerHTML += ' &darr;';
          break;
        case 'descending':
          issuer.innerHTML += ' &uarr;';
          break;
      }

      list.sort(sorting.property, sorting.order);
      list.render(container, loader);
    }

    function showDetailExpose(extern) {
      window.open('detailexpose.html?extern=' + extern + '&cid=' + immobrowse.config.customer + '&parent', '_self', false);
    }

    // Updates filtering settings
    function updateFilters() {
      var priceMax = Number(homeinfo.str.comma2dot($('#price_max').val()));
      filters = {
        types: ['WOHNUNG'],
        marketing: ['MIETE_PACHT'],
        priceMin: Number(homeinfo.str.comma2dot($('#price_min').val())),
        priceMax: priceMax == 0 ? Infinity: priceMax,
        areaMin: Number(homeinfo.str.comma2dot($('#area_min').val())),
        roomsMin: Number(homeinfo.str.comma2dot($('#rooms_min').val())),
        ebk: $("#checkbox_ebk").is(':checked'),
        bathtub: $("#checkbox_bathtub").is(':checked'),
        window: $("#checkbox_window").is(':checked'),
        balcony: $("#checkbox_balcony").is(':checked'),
        carSpace: $("#checkbox_carSpace").is(':checked'),
        guestwc: $("#checkbox_guestwc").is(':checked'),
        elevator: $("#checkbox_elevator").is(':checked'),
        garden: $("#checkbox_garden").is(':checked')
      }

      immobrowse.logger.debug('Filters:');
      immobrowse.logger.debug(JSON.stringify(filters));
    }

    $(document).ready(function () {
      $('#btn_extendedsearch').click(function() {
        if ($('#extendedsearch').attr('style') == "display: none;")
          $('#extendedsearch').slideDown();
        else
          $('#extendedsearch').slideUp();
      });

      $('.btn_filter').on('input',function(e) {
        list.render($("#container"));
      });

      $('.btn_filter_checkbox').click(function() {
        list.render($("#container"));
      });

      updateFilters();
      list = new immobrowse.List(cid, filters, sorting, exposeUrl);
      container = document.getElementById('container');
      loader = $('#loader');
      list.render(container, loader);
    });
  </script>
</head>
<header>
  <button id="rooms" onclick="toggleSorting('rooms')" class="btn btn-primary">Zimmer</button>
  <button id="area" onclick="toggleSorting('area')" class="btn btn-primary">Fl&auml;che</button>
  <button id="street" onclick="toggleSorting('street')" class="btn btn-primary">Stra&szlig;e</button>

  <div style="float:right; margin-right: 30%;">
  <button id="btn_extendedsearch" class="btn btn-default">Erweiterte Suche</button>
  </div><br><br>
  <div id="extendedsearch" style="display: none;">
    <input id="price_min" class="form-control btn_filter" type="number" placeholder="Preis von" onchange="filter()">
    <input id="price_max" class="form-control btn_filter" type="number" placeholder="Preis bis" onchange="filter()">
    <input id="area_min" class="form-control btn_filter" type="number" placeholder="Größe ab in m²" onchange="filter()">
    <input id="rooms_min" class="form-control btn_filter" type="number" placeholder="Zimmer ab" onchange="filter()"><br><br>
    <div class="btn-group" data-toggle="buttons">
    <!--
      <label><strong>Austattung</strong></label><br>
      <input class="btn_filter_checkbox" type="checkbox" id="checkbox_ebk"> Einbauküche (EBK)<br>
      <input class="btn_filter_checkbox" type="checkbox" id="checkbox_bathtub"> Badewanne<br>
      <input class="btn_filter_checkbox" type="checkbox" id="checkbox_window"> Fenster im Bad<br>
      <input class="btn_filter_checkbox" type="checkbox" id="checkbox_balcony"> Balkon<br>
      <input class="btn_filter_checkbox" type="checkbox" id="checkbox_carSpace"> Stellplatz<br>
      <input class="btn_filter_checkbox" type="checkbox" id="checkbox_guestwc"> Gäste-WC<br>
      <input class="btn_filter_checkbox" type="checkbox" id="checkbox_elevator"> Fahrstuhl<br>
      <input class="btn_filter_checkbox" type="checkbox" id="checkbox_garden"> Gartennutzung<br>
      -->
    </div>
  </div>
</header>
<div id="main">
  <div id="loader" class="loader"></div>
  <div id="container">Immobilien werden geladen, bitte warten...</div>
</div>
