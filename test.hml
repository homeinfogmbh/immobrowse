<!DOCTYPE HTML>
<head>
  <link rel="stylesheet" href="stylesheet.css">
  <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

  <!-- Optional theme -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

  <!-- Latest compiled and minified JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
  <script src="immobrowse.js"></script>
  <script>
    var realEstates = [];
    $( document ).ready(getRealEstates);

    function clearList() {
      document.getElementById('container').innerHTML = '';
    }

    function startLoading() {
      var loader = document.getElementById('loader');
      clearList();
      loader.style.display = 'block';
    }


    function stopLoading() {
      var loader = document.getElementById('loader');
      loader.style.display = 'none';
    }


    function getRealEstates() {
      var session = document.getElementById('session').value;
      startLoading();

      $.ajax({
        url: 'https://tls.homeinfo.de/his/realestates/data?session=' + session,
        success: function(json) {
          console.log('Total real estates: ' + json.immobilie.length);
          realEstates = filterRentalFlats(json.immobilie);
          console.log('Rental flats: ' + realEstates.length);
          stopLoading();
        }
      });
    }


    function filterRentalFlats(realEstates) {
      var rentalFlats = [];

      for (realEstate of realEstates) {
        if (realEstate.objektkategorie.vermarktungsart.MIETE_PACHT) {
          if (realEstate.objektkategorie.objektart.wohnung != null) {
            rentalFlats.push(realEstate);
          }
        }
      }

      return rentalFlats;
    }


    function printPreviews(realEstates) {
      var html = '<table>';
      startLoading();

      for (realEstate of realEstates) {
        html += '<tr><td>' + immobrowse.preview(realEstate) + '</td></tr>';
      }

      document.getElementById('container').innerHTML = html + '</table>';
      stopLoading();
    }


    function sortRealEstates() {
      var sortingProperty = document.getElementById("sortingProperty").value;
      var sortingOrder = document.getElementById("sortingOrder").value;
      var sorter = immobrowse.getSorter(sortingProperty, sortingOrder);
      printPreviews(realEstates.sort(sorter));
    }


    function sortAndPrint() {
    }
  </script>
</head>
<header>
   <select id="sortingProperty" onchange="sortRealEstates()">
    <option value="rooms">Zimmer</option>
    <option value="area">Fl&auml;che</option>
    <option value="flowerPots">Flowerpots</option>
  </select>
   <select id="sortingOrder" onchange="sortRealEstates()">
    <option value="ascending">aufsteigend</option>
    <option value="descending">absteigend</option>
  </select>
</header>
Session token: <input id="session"></input>
<button onclick="getRealEstates()">Get real estates</button><br/>
<div id="loader" class="loader"></div>
<div id="container">Real estates go here.</div>
